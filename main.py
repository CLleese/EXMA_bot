import telebot
from telebot import types
import glob
import threading
import time
import schedule
import database
import config

API_TOKEN = config.TOKEN

bot = telebot.TeleBot(API_TOKEN)
#logger = logging.Logger()
helloText = "–í–∞—Å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –±–æ—Ç –∫–æ–Ω—Å–∞–ª—Ç–∏–Ω–≥–æ–≤–æ–≥–æ –ê–≥–µ–Ω—Ç—Å—Ç–≤–∞ Expert MarketingüöÄ\n\n–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —á–µ–∫–ª–∏—Å—Ç—É ¬´–õ—É—á—à–∏–µ —Ü–µ–Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏¬ª –∏ –ø–æ–ª–µ–∑–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º –¥–ª—è —Ä–æ—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É  \"–ü–æ–ª—É—á–∏—Ç—å\" üëá"

# Handle '/start' and '/help'
@bot.message_handler(commands=['start'])
def send_welcome(message):
    
    photo1 = open('img/–ë–∞–∑–æ–≤—ã–π —Ñ–æ–Ω.png', 'rb')
    markup = types.InlineKeyboardMarkup()
    btn1 = types.InlineKeyboardButton(text='–ü–æ–ª—É—á–∏—Ç—å üìö', callback_data='yes');
    markup.add(btn1)
    bot.send_photo(message.from_user.id, photo1, caption=helloText, reply_markup=markup)

    photo1.close()
    
    database.addUser( message.from_user.id, message.date, 1, message.from_user.username)
  
    #–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —á–µ—Ä–µ–∑ 3 –¥–Ω—è –ø—Ä–∏—Å—ã–ª–∞–µ–º –µ–º—É —Å–º—Å–∫—É —Å—á–∞—Å—Ç—å—è, –∞ –ø–æ—Ç–æ–º –æ–ø—è—Ç—å

@bot.callback_query_handler(func=lambda call: True)
def callback_worker(call):
    if call.data == "yes": #call.data —ç—Ç–æ callback_data, –∫–æ—Ç–æ—Ä—É—é –º—ã —É–∫–∞–∑–∞–ª–∏ –ø—Ä–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–∏ –∫–Ω–æ–ø–∫–∏
        #–∫–æ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, –∏–ª–∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True, row_width=2)
        btn = types.KeyboardButton(text='–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!ü§ù')
        markup.add(btn)
        bot.send_message(call.message.chat.id, '–≠—Ç–∏ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –ø–æ–º–æ—á—å –±–∏–∑–Ω–µ—Å—É –≤—ã—Ä–∞—Å—Ç–∏ –±–µ–∑ –≤–ª–æ–∂–µ–Ω–∏–π, –∑–∞ —Å—á–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤\n\n–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º –æ–∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å –∫–∞–∂–¥—ã–º üòâ')
        send_files(call.message, 'files/mat1/')
        bot.send_message(call.message.chat.id, '–£–≤–µ—Ä–µ–Ω—ã, —ç—Ç–∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ–º–æ–≥—É—Ç —Ä–∞–∑–≤–∏—Ç—å –≤–∞—à –±–∏–∑–Ω–µ—Å!', reply_markup= markup)
        

@bot.message_handler(content_types=['text'])
def secondMaterials(message):
    if (message.text == '–û—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ!ü§ù'):
        markup = types.ReplyKeyboardRemove()
        bot.send_message(message.chat.id, '–ò –µ—â—ë –Ω–µ–º–Ω–æ–≥–æ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π ü§ù', reply_markup=markup)
        send_files(message, 'files/mat2/')

def send_files(message, path):
    for filename in glob.glob(f'{path}*.*'):
        with open(filename, 'rb') as f:
            bot.send_document(message.chat.id, f)


def send_spam(id, spam_number):
    text1 = "‚ö†Ô∏è–¢–æ–ø-5 –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ü–µ–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤‚ö†Ô∏è\n\n–ü—Ä–∏–≤–µ—Çüëã\n\n–í—ã —É–∂–µ –Ω–∞—á–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏? –ù–∞–¥–µ–µ–º—Å—è, —á—Ç–æ –æ–Ω–∏ –ø–æ–º–æ–≥—É—Ç –≤ –≤–∞—à–µ–º –±–∏–∑–Ω–µ—Å–µ!\n\n‚ùï–°–µ–≥–æ–¥–Ω—è –º—ã —Ö–æ—Ç–∏–º –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –µ—â—ë –æ–¥–Ω–æ–π –ø–æ–ª–µ–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π: –¢–æ–ø-5 —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ü–µ–Ω –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å—Ç–æ–∏—Ç—å –±–∏–∑–Ω–µ—Å—É –ø—Ä–∏–±—ã–ª–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –¥–µ–ª–∞–µ—Ç–µ –ª–∏ –≤—ã –∏—Ö:\n\n1Ô∏è‚É£ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ —Ü–µ–Ω–µ ‚Äì –≤–∞–∂–Ω–æ —É—á–∏—Ç—ã–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ —Ü–µ–Ω—É, –Ω–æ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç\n\n2Ô∏è‚É£ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äì —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –≤—ã–≤–æ–¥–æ–≤\n\n3Ô∏è‚É£ –ù–µ–¥–æ–æ—Ü–µ–Ω–∏–≤–∞–Ω–∏–µ —Å–∫–∏–¥–æ–∫ –∏ –∞–∫—Ü–∏–π –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ ‚Äì –Ω–µ–¥–æ–æ—Ü–µ–Ω–∫–∞ –∏—Ö –≤–ª–∏—è–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ —Ä—ã–Ω–∫–∞\n\n4Ô∏è‚É£ –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–∏ —Ä—ã–Ω–∫–∞ ‚Äì –≤–∞–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ü–µ–Ω–∞—Ö, –æ—Å–æ–±–µ–Ω–Ω–æ –≤–æ –≤—Ä–µ–º—è —Å–µ–∑–æ–Ω–Ω—ã—Ö –∫–æ–ª–µ–±–∞–Ω–∏–π\n\n–ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å —É—á–µ—Å—Ç—å —ç—Ç–∏ –º–æ–º–µ–Ω—Ç—ã –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–≤–æ–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏!\n\n–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ —Ç–æ–º, –∫–∞–∫ –º—ã –º–æ–∂–µ–º –ø–æ–º–æ—á—å –≤–∞—à–µ–º—É –±–∏–∑–Ω–µ—Å—É ‚Äì –∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É üëá"
    text2 = "‚ö†Ô∏è–ö–∞–∫ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–¥—É–∫—Ç –ø–æ –æ—Ç–Ω–æ—à–µ–Ω–∏—é –∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–∞–º?‚ö†Ô∏è\n\n–ü—Ä–∏–≤–µ—Çüëã\n\n‚ùï–°–µ–≥–æ–¥–Ω—è –ø–∞—Ä–∞ —Å–æ–≤–µ—Ç–æ–≤ –æ —Ç–æ–º, —á—Ç–æ —Å—Ç–æ–∏—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –ø—Ä–∏ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏. –í–∞–∂–Ω–æ, —á—Ç–æ–±—ã –≤–∞—à –±–∏–∑–Ω–µ—Å –≤—ã–¥–µ–ª—è–ª—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ —Ü–µ–Ω–æ–π. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–≤–µ—Ç–æ–≤, –∫–∞–∫ —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å:\n\n1Ô∏è‚É£ –§–æ–∫—É—Å –Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ ‚Äì –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–π—Ç–µ, —á–µ–º –≤–∞—à –ø—Ä–æ–¥—É–∫—Ç –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, –∞ –ø–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ, –∫–∞–∫ –æ–Ω —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –ª—É—á—à–µ\n\n2Ô∏è‚É£ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ –∏ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ ‚Äì —á–µ–º —á–∞—â–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã —Å –Ω–∏–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç–µ, —Ç–µ–º –ª—É—á—à–µ. –û–±–µ—Å–ø–µ—á—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö –ø–æ–∫—É–ø–∫–∏\n\n3Ô∏è‚É£ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ ‚Äì —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–∂–¥—ã–π –≤–∞—à –∫–∞–Ω–∞–ª –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è, –æ—Ç —Å–∞–π—Ç–∞ –¥–æ —Ä–µ–∫–ª–∞–º—ã ‚Äì —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –∫–ª—é—á–µ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: –ø–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –≤—ã–±—Ä–∞—Ç—å –∏–º–µ–Ω–Ω–æ –≤–∞—Å\n\n–ò –ø–æ–º–Ω–∏—Ç–µ, —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤—Å–µ–≥–¥–∞ –ø–æ–±–µ–∂–¥–∞–µ—Ç —Ü–µ–Ω—É, –µ—Å–ª–∏ –æ–Ω–∞ —á—ë—Ç–∫–æ –¥–æ–Ω–µ—Å–µ–Ω–∞ –¥–æ –∫–ª–∏–µ–Ω—Ç–∞!\n\n–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ —É–∑–Ω–∞—Ç—å –±–æ–ª—å—à–µ –æ —Ç–æ–º, –∫–∞–∫ –º—ã –º–æ–∂–µ–º –ø–æ–º–æ—á—å –≤–∞—à–µ–º—É –±–∏–∑–Ω–µ—Å—É ‚Äì –∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É üëá"
    

    if spam_number == 1:
        text = text1
        photo = open('img/–ø–æ—Å—Ç1.png', 'rb')

    elif spam_number == 2:
        text = text2
        photo = open('img/–ø–æ—Å—Ç2.png', 'rb')
    else:
        return

    markup = types.InlineKeyboardMarkup()
    btn1 = types.InlineKeyboardButton(text='–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É üì¨', url="https://ex-ma.ru/fos");
    markup.add(btn1)

    bot.send_photo(id, photo, caption=text, reply_markup=markup)



def spam():
    list_for_spamming = []

    list_for_spamming = database.checkUsers()
    if not list_for_spamming:
        print("–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ—Ç –ª–æ–ª")
            
    else:
        print("–Æ–ó–ï–†–´ –ï–°–¢–¨ –£–†–ê")
        sym_to_remove = "(),"
        for user in list_for_spamming:
            tmp = str(user[0])
            for char in sym_to_remove:
                tmp = tmp.replace(char, "")
            send_spam(int(tmp), user[1])

def shedule_func():
    schedule.every().minute.do(spam)
    while True:
        time.sleep(1)
        schedule.run_pending()

threading.Thread(target=shedule_func).start()

bot.infinity_polling()